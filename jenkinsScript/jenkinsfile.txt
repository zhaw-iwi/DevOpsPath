pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                sh 'echo checkout'
                checkout([$class: 'GitSCM', branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/zhaw-kabboahm/DevOpsPath']]])
            }
        }
        stage('Build backend') {
            steps {
                echo 'Build backend'
                sh "chmode +x gradlew"
                sh "./gradlew build --stacktrace" //run gradle task
                step( [ $class: 'JacocoPublisher'])
            }
        }
        stage('Unit and integration test') {
            steps {
                echo 'Testing'
                junit(
                    allowEmptyResults: true,
                    testResults: '**/test-reports/*.xml'
                )
            }
        }
        stage('Build frontend') {
            steps {
                echo 'Build frontend'
                nodejs('NodeJS 14.6.0') {
                    sh 'npm install --prefix frontend'
                    sh 'npm run build --prefix frontend'
                }
            }
        }
    }
}